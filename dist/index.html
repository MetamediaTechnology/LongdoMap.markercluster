<!DOCTYPE html>
<html>
<head>
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="https://api.longdo.com/map/?key=171082bb9618aa7b985baa7098d6bdce&debug=1"></script>
	<script type="text/javascript" src="longdomap.markercluster-src.js"></script>
	<title>MarkerClusterTest</title>
	<style type="text/css">
          html{
            height:100%;
          }
          body{
            margin:0px;
            height:100%;
          }
          #map {
            height: 100%;
            width: 100%;
          }
        </style>
</head>
<body onload="init();">
<div id="map"></div>
<script type="text/javascript">
	var map;
	var markercluster;
	var img;
	var markers = [];
	function init() {
		map = new longdo.Map({
			placeholder: document.getElementById('map'),
			language: 'en',
		});
		markercluster = new lmc.MarkerCluster(map,{minClusterSize:2});
		img = new Image();
		img.onload = function() {
			$.getJSON('https://search.longdo.com/mapsearch/json/search?key=171082bb9618aa7b985baa7098d6bdce&callback=?',
			{
				tag:'7-11',
				locale:'en',
				limit: 100,
				lat: map.location().lat,
				lon: map.location().lon,
				span: '10km'
			},
			function(data){
				var len = data.data.length;
				while(len--){
					var d = data.data[len];
					if(!d.verified){
						continue;
					}
					markercluster.addMarkers(new longdo.Marker({lat:d.lat,lon:d.lon},
					{
						icon:{
							url: 'https://map.longdo.com/mmmap/images/pin_mark.png',
							offset: { x: 12, y: 45 },
							size: {width: 24, height: 45}
						}
					}));
				}
				markercluster.render();
			});
		};
		img.src = 'https://map.longdo.com/mmmap/images/pin_mark.png';
		
	}
</script>
</body>
</html>