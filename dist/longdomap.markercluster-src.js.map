{"version":3,"sources":["webpack://lmc/webpack/bootstrap","webpack://lmc/./src/Cluster.js","webpack://lmc/./src/ConfigHandler.js","webpack://lmc/./src/Icon.js","webpack://lmc/./src/LLBBox.js","webpack://lmc/./src/MarkerCluster.js","webpack://lmc/./src/index.js"],"names":["longdo","window","markerCluster","config","iloader","_markerCluster","_config","_map","_center","_markers","_bounds","_clusterIcon","ClusterIcon","marker","tile","location","_calculateBounds","averageCenter","Util","averageLocation","Projections","EPSG3857","isAdded","push","swarmModeEnabled","swarmAlg","_gridids","LLBBox","generateFrom","boundOfTile","getNxNGridCord","_markersToShow","length","markersInSameGrid","that","forEach","value","gridid","u","v","active","Overlays","add","updateIcon","remove","removeArea","generateRect","extendSize","gridSize","Math","pow","zoom","drawMarkerArea","drawArea","isLocInBounds","len","setSums","setCenter","show","options","maxZoom","minClusterSize","clusterRadius","parseInt","styles","cluster","_cluster","_iloader","_visible","_sums","_clusterMarker","Marker","getIcon","OverlayWeight","Top","pos","mz","move","lat","lon","hide","setLocation","_poly","Polygon","getRectVertex","center","sums","element","changeNumber","IconLoader","markercluster","_images","Map","ready","useDefault","loadStyles","url","width","height","minThreshold","img","Image","set","onload","get","values","every","elm","resetViewport","_createClusters","src","keys","sort","elm1","elm2","style","load","index","result","document","createElement","elm3","appendChild","marginLeft","marginTop","overflow","className","html","outerHTML","size","background","encodeURI","lineHeight","color","fontWeight","textAlign","num","children","innerText","list","locations","_projection","_locationList","slice","_originalLocationList","locationBound","minLon","minLat","maxLon","maxLat","b","filter","e","empty","loc","contains","diff","maxy","latToNorm","miny","normToLat","map","n","xlen","ylen","_lat2y","lonoffset","yoffset","xid","floor","yid","y","atan","exp","PI","log","tan","bound","loc1","loc2","LLCircle","radius","sqrad","Error","MarkerCluster","_clusters","_prevZoom","_ready","Config","Event","bind","overlay","cl","l","len2","setTimeout","markers","m","shuffle","i","r","random","temp","mapBounds","bounds","_addToClosestCluster","_addToTiledCluster","finalize","distance","Number","POSITIVE_INFINITY","clusterToAddTo","cen","d","isMarkerInClusterBounds","addMarker","Cluster","locationToTile","point","locationToPoint","z","pointToTile","indexOf","splice","removed","_removeMarker","markersCopy"],"mappings":"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","file":"longdomap.markercluster-src.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","import {ClusterIcon} from './Icon';\r\nimport {LLBBox} from './LLBBox';\r\nconst longdo = window.longdo;\r\nexport default class{\r\n    \r\n    constructor(markerCluster,config,iloader){\r\n        this._markerCluster = markerCluster;\r\n        this._config = config;\r\n        this._map = markerCluster._map;\r\n        \r\n        this._center = null;\r\n        this._markers = [];\r\n        this._bounds = null;\r\n        this._clusterIcon = new ClusterIcon(this,this._config,iloader);\r\n    }\r\n\r\n    addMarker(marker,tile){\r\n        // if(this._markers.indexOf(marker) !== -1){\r\n        //     return false;\r\n        // }\r\n\r\n        if(!this._center){\r\n            this._center = marker.location();\r\n            this._calculateBounds();\r\n        }else{\r\n            if(this._config.averageCenter){\r\n                this._center = longdo.Util.averageLocation(longdo.Projections.EPSG3857,\r\n                    this._center,marker.location());\r\n            }\r\n        }\r\n        marker.isAdded = true;\r\n        this._markers.push(marker);\r\n\r\n        if(this._config.swarmModeEnabled && this._config.swarmAlg === 1){\r\n            //TODO\r\n            if(!this._gridids){\r\n                this._gridids = [];\r\n            }\r\n            this._gridids.push(LLBBox.generateFrom(\r\n                longdo.Util.boundOfTile(longdo.Projections.EPSG3857,tile)\r\n            ).getNxNGridCord(marker.location(),4));\r\n\r\n            \r\n            if(!this._markersToShow){\r\n                this._markersToShow = [marker];\r\n            }else if(this._markersToShow.length <= 64){\r\n                let markersInSameGrid = 0;\r\n                const that = this;\r\n                this._gridids.forEach(function(value){\r\n                    const gridid = that._gridids[that._gridids.length-1];\r\n                    markersInSameGrid += gridid.u === value.u && gridid.v === value.v ? 1 : 0;\r\n                });\r\n\r\n                if(markersInSameGrid % 8 !== 0){\r\n                    return true;\r\n                }\r\n                this._markersToShow.push(marker);\r\n            }else{\r\n                return true;\r\n            }\r\n            if(!marker.active()){\r\n                this._map.Overlays.add(marker);\r\n            }\r\n            this.updateIcon();\r\n            return true;\r\n        }else if(this._config.swarmModeEnabled && this._config.swarmAlg === 2){\r\n            if(this._markers.length < 11 || this._markers.length % 10 === 0){\r\n                if(!marker.active()){\r\n                    this._map.Overlays.add(marker);\r\n                }\r\n            }\r\n            this.updateIcon();\r\n            return true;\r\n        }\r\n\r\n        // const len = this._markers.length;\r\n        // if (len < this._config.minClusterSize){\r\n        //     if(!marker.active()){\r\n        //         this._map.Overlays.add(marker);\r\n        //     }\r\n        // }\r\n        // if(len === this._config.minClusterSize){\r\n        //     let i = this._config.minClusterSize;\r\n        //     while(i--){\r\n        //         const m = this._markers[i];\r\n        //         this._map.Overlays.remove(m);\r\n        //     }\r\n        // }\r\n        // if(len === this._config.minClusterSize){\r\n        //     let lenc = len;\r\n        //     while(lenc--){\r\n        //         const m = this._markers[lenc];\r\n        //         if(m.active()){\r\n        //             this._map.Overlays.remove(m);\r\n        //         }\r\n        //     }\r\n        // }\r\n        // if(len >= this._config.minClusterSize){\r\n        //     let lenc = len;\r\n        //     while(lenc--){\r\n        //         const m = this._markers[lenc];\r\n        //         if(m.active()){\r\n        //             this._map.Overlays.remove(m);\r\n        //         }\r\n        //     }\r\n        // }\r\n        // this.updateIcon();\r\n        return true;\r\n    }\r\n    remove(){\r\n        this._clusterIcon.remove();\r\n        this._markers.length = 0;\r\n        delete this._markers;\r\n        this._bounds.removeArea(this._map);\r\n    }\r\n\r\n    _calculateBounds(){\r\n        this._bounds = LLBBox.generateRect(this._center).extendSize(this._config.gridSize*Math.pow(2,-this._map.zoom()));     \r\n    }\r\n    updateIcon(){\r\n        if(this._config.drawMarkerArea){\r\n            this._bounds.drawArea(this._map);\r\n        }\r\n        // const zoom = this._map.zoom();\r\n        // const mz = this._config.maxZoom;\r\n        // if(mz && zoom > mz || zoom === 20){\r\n        //     let len = this._markers.length;\r\n        //     while(len--){\r\n        //         const marker = this._markers[len];\r\n        //         if(!marker.active()){\r\n        //             this._map.Overlays.add(marker);\r\n        //         }\r\n        //     }\r\n        //     return;\r\n        // }\r\n\r\n        if(this._config.swarmModeEnabled){\r\n            //TODO\r\n            return;\r\n        }\r\n\r\n        // if(this._markers.length < this._config.minClusterSize){\r\n        //     this._clusterIcon.hide();\r\n        //     return;\r\n        // }\r\n        // const sums = this._markers.length;\r\n        // this._clusterIcon.setCenter(this._center);\r\n        // this._clusterIcon.setSums(sums);\r\n        // this._clusterIcon.show();\r\n    }\r\n\r\n    isMarkerInClusterBounds(marker){\r\n        return this._bounds.isLocInBounds(marker.location());\r\n    }\r\n    containsMarker(marker){\r\n        let len = this._markers.length;\r\n        while(len--){\r\n            if(this._markers[len] === marker){\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    finalize(){\r\n        this._clusterIcon.setSums(this._markers.length);\r\n        this._clusterIcon.setCenter(this._center);\r\n        this._clusterIcon.show();\r\n    }\r\n}","export default class {\r\n    constructor(options){\r\n        this.maxZoom = options.maxZoom || null;\r\n        this.minClusterSize = options.minClusterSize || 2;\r\n        this.gridSize = options.gridSize || 120;\r\n        this.clusterRadius = options.clusterRadius || this.gridSize;\r\n        this.averageCenter = options.averageCenter;\r\n        this.drawMarkerArea = options.drawMarkerArea;\r\n        this.swarmModeEnabled = options.swarmModeEnabled;\r\n        this.swarmAlg = options.swarmAlg ? parseInt(options.swarmAlg,10) : null;\r\n        this.styles = options.styles || null;\r\n    }\r\n}","const longdo = window.longdo;\r\nexport class ClusterIcon{\r\n    constructor(cluster,config,iloader){\r\n        this._cluster = cluster;\r\n        this._config = config;\r\n        this._iloader = iloader;\r\n        this._center = null;\r\n        this._map = cluster._map;\r\n        this._visible = false;\r\n        this._sums = null;\r\n        this._clusterMarker = new longdo.Marker({\"lat\":0,\"lon\":0},{\r\n            \"icon\": this._cluster._markerCluster._iloader.getIcon(0),\r\n            \"weight\": longdo.OverlayWeight.Top\r\n        });\r\n    }\r\n\r\n    show(){\r\n        if(!this._config.swarmModeEnabled){\r\n            const pos = this._center;\r\n            if (this._cluster._markers.length < this._config.minClusterSize){\r\n                const marker = this._cluster._markers[0];\r\n                if(!marker.active()){\r\n                    this._cluster._map.Overlays.add(this._cluster._markers[0]);\r\n                }\r\n                return;\r\n            }\r\n            const zoom = this._map.zoom();\r\n            const mz = this._config.maxZoom;\r\n            if(mz && zoom > mz || zoom === 20){\r\n                let len = this._cluster._markers.length;\r\n                while(len--){\r\n                    const marker = this._markers[len];\r\n                    if(!marker.active()){\r\n                        this._cluster._map.Overlays.add(marker);\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n            this._clusterMarker.move({\"lat\":pos.lat,\"lon\":pos.lon});\r\n            if(this._cluster._markers.length < this._config.minClusterSize){\r\n                this.hide();\r\n                return;\r\n            }\r\n            if(this._clusterMarker.active()){\r\n                this._map.Overlays.move(this._clusterMarker,pos);\r\n            }else{\r\n                this._clusterMarker.setLocation(pos);\r\n                this._map.Overlays.add(this._clusterMarker);\r\n                if(this._poly){\r\n                    this._map.Overlays.remove(this._poly);\r\n                }\r\n                if(this._config.drawMarkerArea){\r\n                    this._poly = new longdo.Polygon(this._cluster._bounds.getRectVertex(),{\"fillColor\": \"rgba(0,0,0,0.3)\"});\r\n                    this._map.Overlays.add(this._poly);\r\n                }\r\n            }\r\n            this._visible = true;\r\n        }\r\n    }\r\n    remove(){\r\n        this._map.Overlays.remove(this._clusterMarker);\r\n        if(this._poly){\r\n            this._map.Overlays.remove(this._poly);\r\n            this._poly = null;\r\n        }\r\n    }\r\n    hide(){\r\n        this._map.Overlays.remove(this._clusterMarker);\r\n        this._visible = false;\r\n        if(this._config.drawMarkerArea){\r\n            if(!this._poly){\r\n                this._poly = new longdo.Polygon(this._cluster._bounds.getRectVertex(),{\"fillColor\": \"rgba(0,0,0,0.3)\"});\r\n            }\r\n            if(!this._poly.active()){\r\n                this._map.Overlays.add(this._poly);\r\n            }\r\n        }\r\n    }\r\n    setCenter(center){\r\n        this._center = center;\r\n        // if(this._clusterMarker){\r\n        //     this._clusterMarker.move({\"lat\":center.lat,\"lon\":center.lon});\r\n        // }\r\n    }\r\n    setSums(sums){\r\n        if(this._sums && sums === this._sums){return;}\r\n        this._sums = sums;\r\n        if(this._clusterMarker && this._clusterMarker.element()){\r\n            this._iloader.changeNumber(this._clusterMarker.element(),this._sums);\r\n        }\r\n    }\r\n}\r\n\r\nexport class IconLoader{\r\n\r\n    constructor(markercluster,config){\r\n        this._markerCluster = markercluster;\r\n        this._config = config;\r\n        this._images = new Map();\r\n        this.ready = false;\r\n        this.useDefault = true;\r\n        if(this._config.styles){\r\n            this.loadStyles(this._config.styles);\r\n        }\r\n    }\r\n    load(url,width,height,minThreshold){\r\n        this.ready = false;\r\n        this.useDefault = false;\r\n        const img = new Image(width,height);\r\n        this._images.set(img,{\"ready\":false,\"minThreshold\":minThreshold});\r\n        const that = this;\r\n        img.onload = function(){\r\n            that._images.get(img).ready = true;\r\n            if([...that._images.values()].every(elm => elm.ready)){\r\n                that.ready = true;\r\n                that._markerCluster.resetViewport();\r\n                that._markerCluster._createClusters();\r\n            }\r\n        };\r\n        img.src = url;\r\n        return this._images.keys.length - 1;\r\n    }\r\n    loadStyles(styles){\r\n        styles.sort((elm1,elm2) => \r\n        elm1.minThreshold < elm2.minThreshold ? 1 : elm1.minThreshold === elm2.minThreshold ?\r\n         0 : -1); \r\n         let len = styles.length;\r\n         while(len--){\r\n             const style = styles[len];\r\n             this.load(style.url,style.width,style.height,style.minThreshold);\r\n         }\r\n    }\r\n    getIcon(index){\r\n        const result = {\"offset\": { \"x\": 0, \"y\": 0}};\r\n        if(this.useDefault || typeof index === 'undefined'){\r\n            const elm = document.createElement(\"div\");\r\n            const elm2 = document.createElement('div');\r\n            const elm3 = document.createElement('span');\r\n            elm.appendChild(elm2);\r\n            elm2.appendChild(elm3);\r\n            elm.style.width = '40px';\r\n            elm.style.height = '40px';\r\n            elm.style.marginLeft = '-20px';\r\n            elm.style.marginTop = '-20px';\r\n            elm.style.overflow = 'hidden';\r\n            elm.className = 'marker-cluster marker-cluster-small leaflet-marker-icon';\r\n            result.html = elm.outerHTML;\r\n            result.size = {\"width\":40,\"height\":40};\r\n        }else{\r\n            const img = [...this._images.keys()][index];\r\n            const elm = document.createElement(\"div\");\r\n            elm.style.width = `${img.width}px`;\r\n            elm.style.height = `${img.height}px`;\r\n            elm.style.marginLeft = `-${img.width/2}px`;\r\n            elm.style.marginTop = `-${img.height/2}px`;\r\n            elm.style.background = `url('${encodeURI(img.src)}') no-repeat center top`;\r\n            elm.style.lineHeight = elm.style.height;\r\n            elm.style.color = 'black';\r\n            elm.style.fontWeight = 'bold';\r\n            elm.style.textAlign = 'center';\r\n            result.html = elm.outerHTML;\r\n            result.size = {\"width\":img.width,\"height\":img.height};\r\n        }\r\n        return result;\r\n    }\r\n    changeNumber(element,num){\r\n        if(this.useDefault){\r\n            element.children[0].children[0].children[0].innerText = `${num}`;\r\n            if(num < 10){\r\n                element.children[0].className = 'marker-cluster marker-cluster-small leaflet-marker-icon';\r\n            }else if(num < 100){\r\n                element.children[0].className = 'marker-cluster marker-cluster-medium leaflet-marker-icon';\r\n            }else{\r\n                element.children[0].className = 'marker-cluster marker-cluster-large leaflet-marker-icon';\r\n            }\r\n        }else{\r\n            element.children[0].innerText = `${num}`;\r\n            const list = [...this._images.keys()];\r\n            let len = list.length;\r\n            while(len--){\r\n                const img = list[len];\r\n                if(num >= this._images.get(img).minThreshold){\r\n                    let elm = element;\r\n                    elm.style.width = `${img.width}px`;\r\n                    elm.style.height = `${img.height}px`;\r\n                    elm = elm.children[0];\r\n                    elm.style.background = `url('${encodeURI(img.src)}') no-repeat center top`;\r\n                    elm.style.width = `${img.width}px`;\r\n                    elm.style.height = `${img.height}px`;\r\n                    elm.style.lineHeight = elm.style.height;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n}","const longdo = window.longdo;\r\nexport class LLBBox{\r\n    constructor(locations){\r\n        this._projection = longdo.Projections.EPSG3857;\r\n        this._locationList = locations.slice();\r\n        this._originalLocationList = this._locationList.slice();\r\n        if(locations.length > 0){\r\n            this._bounds = longdo.Util.locationBound(this._locationList);\r\n        }\r\n    }\r\n\r\n    static generateFrom(bound){\r\n        return new LLBBox(\r\n            [\r\n                {\"lon\":bound.minLon,\"lat\":bound.minLat},\r\n                {'lon':bound.maxLon,'lat':bound.maxLat}]);\r\n    }\r\n    static generateRect(loc1,loc2){\r\n        if(!loc2){\r\n            loc2 = loc1;\r\n        }\r\n        return new LLBBox([loc1,loc2]);\r\n    }\r\n\r\n    getBounds(){\r\n        return {'minLon':this._bounds.minLon,\r\n                'minLat':this._bounds.minLat,\r\n                'maxLon':this._bounds.maxLon,\r\n                'maxLat':this._bounds.maxLat};\r\n    }\r\n    LT(){\r\n        return {\"lon\": this._bounds.minLon, \"lat\": this._bounds.maxLat};\r\n    }\r\n    RT(){\r\n        return {\"lon\": this._bounds.maxLon, \"lat\": this._bounds.maxLat}; \r\n    }\r\n    LB(){\r\n        return {\"lon\": this._bounds.minLon, \"lat\": this._bounds.minLat};\r\n    }\r\n    RB(){\r\n        return {\"lon\": this._bounds.maxLon, \"lat\": this._bounds.minLat};\r\n    }\r\n    getMinimumBounds(){\r\n        const b = longdo.Util.locationBound(this._originalLocationList);\r\n        return b;\r\n    }\r\n\r\n    add(location){\r\n        this._locationList.push(location);\r\n        this._originalLocationList.push(location);\r\n        this._bounds = longdo.Util.locationBound(this._locationList);\r\n    }\r\n    remove(location){\r\n        this._locationList = this._locationList.filter((e) => e !== location);\r\n        this._originalLocationList = this._originalLocationList.filter((e) => e !== location);\r\n        this._bounds = this.empty() ? null: longdo.Util.locationBound(this._locationList);\r\n    }\r\n\r\n    empty(){return this._locationList.length === 0;}\r\n\r\n    getLocations(){\r\n        return this._locationList.slice();\r\n    }\r\n    isLocInBounds(loc){\r\n        const result = longdo.Util.contains(loc,this.getRectVertex());\r\n        return result === null ? true : result;\r\n    }\r\n    extendSize(diff){\r\n        const b = this._bounds;\r\n        const maxy = this._projection.latToNorm(b.maxLat) + diff;\r\n        const miny = this._projection.latToNorm(b.minLat) - diff;\r\n        this._locationList.push({\"lon\":b.minLon - diff,\"lat\": this._projection.normToLat(miny)});\r\n        this._locationList.push({\"lon\":b.minLon - diff,\"lat\": this._projection.normToLat(maxy)});\r\n        this._locationList.push({\"lon\":b.minLon + diff,\"lat\": this._projection.normToLat(miny)});\r\n        this._locationList.push({\"lon\":b.maxLon + diff,\"lat\": this._projection.normToLat(maxy)});\r\n        this._bounds = longdo.Util.locationBound(this._locationList);\r\n        return this;\r\n    }\r\n    getRectVertex(){\r\n        return [{\"lon\":this._bounds.minLon,\"lat\":this._bounds.minLat},\r\n        {\"lon\":this._bounds.minLon,\"lat\":this._bounds.maxLat},\r\n        {\"lon\":this._bounds.maxLon,\"lat\":this._bounds.maxLat},\r\n        {\"lon\":this._bounds.maxLon,\"lat\":this._bounds.minLat}];\r\n    }\r\n\r\n    drawArea(map){\r\n        this._poly = new longdo.Polygon(this.getRectVertex());\r\n        map.Overlays.add(this._poly);\r\n    }\r\n    removeArea(map){\r\n        if(this._poly && this._poly.active()){\r\n            map.Overlays.remove(this._poly);\r\n            delete this._poly;\r\n        }\r\n    }\r\n\r\n    getNxNGridCord(loc,n){\r\n        if(!this.isLocInBounds(loc)){\r\n            return null;\r\n        }\r\n        const xlen = (this._bounds.maxLon - this._bounds.minLon) / n;\r\n        const ylen = (this._lat2y(this._bounds.maxLat) - this._lat2y(this._bounds.minLat)) / n;\r\n        let lonoffset = loc.lon - this._bounds.minLon;\r\n        const yoffset = -this._lat2y(loc.lat) + this._lat2y(this._bounds.maxLat);\r\n        const xid = Math.floor(lonoffset / xlen), yid = Math.floor(yoffset / ylen);\r\n        return {\"u\": xid,\"v\": yid};\r\n    }\r\n\r\n    /*\r\n    Adapted from https://wiki.openstreetmap.org/wiki/Mercator\r\n    */\r\n    _y2lat(y) { return (Math.atan(Math.exp(y / (180 / Math.PI))) / (Math.PI / 4) - 1) * 90; }\r\n    _lat2y(lat) { return Math.log(Math.tan((lat / 90 + 1) * (Math.PI / 4) )) * (180 / Math.PI); }\r\n}\r\n\r\nexport class LLCircle{\r\n    constructor(center,radius){\r\n        this.center = center;\r\n        this.sqrad = radius * radius;\r\n    }\r\n}","if(typeof window.longdo === 'undefined'){\r\n    throw new Error('longdo API must be loaded before the longdomap markercluster plugin');\r\n}\r\nconst longdo = window.longdo;\r\nimport {LLBBox} from \"./LLBBox\";\r\nimport Config from \"./ConfigHandler\";\r\nimport {IconLoader} from './Icon';\r\nimport Cluster from './Cluster';\r\nexport default class MarkerCluster{\r\n\r\n    constructor(map, options){\r\n        this._map = map;\r\n        this._markers = [];\r\n        this._clusters = [];\r\n        this._prevZoom = 2;\r\n        this._ready = false;\r\n        this.config = new Config(options);\r\n        this._iloader = new IconLoader(this,this.config);\r\n        \r\n        const that = this;\r\n        this._map.Event.bind('ready',function() {\r\n            if(!that._ready && !that._iloader.ready){return;}\r\n            that._prevZoom = that._map.zoom;\r\n            that.resetViewport();\r\n            that._createClusters();\r\n        });\r\n        this._map.Event.bind('zoom', function (/*pivot*/){\r\n            if(!that._ready && !that._iloader.ready){return;}\r\n            const zoom = that._map.zoom();\r\n            if(that._prevZoom !== zoom){\r\n                that._prevZoom = zoom;\r\n                that.resetViewport();\r\n                that._createClusters();\r\n            }\r\n        });\r\n        this._map.Event.bind('idle',function() {\r\n            if(!that._ready && !that._iloader.ready){return;}\r\n            //that.resetViewport();\r\n            //that._createClusters();\r\n        });\r\n        this._map.Event.bind('drop',function() {\r\n            if(!that._ready && !that._iloader.ready){return;}\r\n            that.resetViewport();\r\n            that._createClusters();\r\n        });/*\r\n        this._map.Event.bind('drag', function(move){\r\n            if(that._ready){\r\n                that.resetViewport();\r\n                that._createClusters();\r\n            }\r\n        });\r\n        */\r\n    //    this._map.Event.bind('loadTile',function(str) {\r\n    //         if(str !== 'finish' && !that._ready && !that._iloader.ready){return;}\r\n    //         that.resetViewport();\r\n    //         that._createClusters();\r\n    //     });\r\n        this._map.Event.bind('overlayClick', function(overlay){\r\n            if(!that._ready){return;}\r\n            let len = that._clusters.length;\r\n            while(len--){\r\n                const cl = that._clusters[len];\r\n                if(overlay === cl._clusterIcon._clusterMarker){\r\n                    const l = [];\r\n                    let len2 = cl._markers.length;\r\n                    while(len2--){\r\n                        l.push(cl._markers[len2].location());\r\n                    }\r\n                    //that._map.bound(cl._bounds.getBounds());\r\n                    that._map.bound(longdo.Util.locationBound(l));\r\n                    setTimeout(function(){\r\n                        that.resetViewport();\r\n                        that._createClusters();\r\n                    },0);\r\n                    return;\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    addMarkers(markers){\r\n        if(markers instanceof longdo.Marker){\r\n            markers = [markers];\r\n        }\r\n        let len = markers.length;\r\n        while(len--){\r\n            const m = markers[len];\r\n            this._markers.push(m);\r\n        }\r\n        if(this.config.swarmModeEnabled && this.config.swarmAlg === 2){\r\n            this.shuffle();\r\n        }\r\n    }\r\n    shuffle(){\r\n        for(let i = this._markers.length-1;i > 0; i--){\r\n            const r = Math.floor(Math.random()*(i+1));\r\n            const temp = this._markers[i];\r\n            this._markers[i] = this._markers[r];\r\n            this._markers[r] = temp;\r\n        }\r\n    }\r\n    render(){\r\n        this._ready = true;\r\n        if(this._iloader.ready){\r\n            this.resetViewport();\r\n            this._createClusters();\r\n        }\r\n    }\r\n    _createClusters(){\r\n        if(!this._ready){return;}\r\n        const mapBounds = LLBBox.generateFrom(this._map.bound());\r\n        const bounds = mapBounds.extendSize(this.config.gridSize*Math.pow(2,-this._map.zoom()));\r\n        let len = this._markers.length;\r\n        while(len--){\r\n            const m = this._markers[len];\r\n            const loc = m.location();\r\n            if(!m.isAdded && bounds.isLocInBounds(loc)){\r\n                if(!this.config.swarmModeEnabled){\r\n                    this._addToClosestCluster(m);\r\n                }else{\r\n                    if(this.config.swarmAlg === 2){\r\n                        this._addToClosestCluster(m);\r\n                    }else{\r\n                        this._addToTiledCluster(m);\r\n                    }\r\n                }\r\n                \r\n            }\r\n        }\r\n        len = this._clusters.length;\r\n        while(len--){\r\n            const cl = this._clusters[len];\r\n            cl.finalize();\r\n        }\r\n    }\r\n    _addToClosestCluster(marker){\r\n        let distance = Number.POSITIVE_INFINITY;\r\n        let clusterToAddTo = null;\r\n        let len = this._clusters.length;\r\n        while(len--){\r\n            const cluster = this._clusters[len];\r\n            const cen = cluster._center;\r\n            if(cen){\r\n                const d = longdo.Util.distance([cen,marker.location()]);\r\n                if(d < distance){\r\n                    distance = d;\r\n                    clusterToAddTo = cluster;\r\n                }\r\n            }\r\n        }\r\n        if(clusterToAddTo && clusterToAddTo.isMarkerInClusterBounds(marker)){\r\n            clusterToAddTo.addMarker(marker);\r\n        }else{\r\n            const cluster = new Cluster(this,this.config,this._iloader);\r\n            cluster.addMarker(marker);\r\n            this._clusters.push(cluster);\r\n        }\r\n    }\r\n\r\n    _addToTiledCluster(marker){\r\n        const that = this;\r\n        const locationToTile = function(loc){\r\n            const point = longdo.Util.locationToPoint(longdo.Projections.EPSG3857,loc);\r\n            point.z = 20-that._map.zoom();\r\n            return longdo.Util.pointToTile(point);\r\n        };\r\n        const tile = locationToTile(marker.location());\r\n        let len = this._clusters.length;\r\n        while(len--){\r\n            const cluster = this._clusters[len];\r\n            if(cluster.u === tile.u && cluster.v === tile.v){\r\n                cluster.addMarker(marker,tile);\r\n                return;\r\n            }\r\n        }\r\n        const cluster = new Cluster(this,this.config,this._iloader);\r\n        cluster.u = tile.u;\r\n        cluster.v = tile.v;\r\n        cluster.addMarker(marker,tile);\r\n        this._clusters.push(cluster);\r\n    }\r\n\r\n    _removeMarker(marker){\r\n        const index = this._markers.indexOf(marker);\r\n        if(index === -1){\r\n            return false;\r\n        }\r\n        this._map.Overlays.remove(marker);\r\n        this._markers.splice(index,1);\r\n        return true;\r\n    }\r\n\r\n    removeMarker(marker){\r\n        const removed = this._removeMarker(marker);\r\n        if(removed){\r\n            this.resetViewport();\r\n            this._createClusters();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    removeMarkers(markers){\r\n        const markersCopy = markers === this._markers ? this._markers.slice() : markers;\r\n        let removed = false;\r\n        let len = markersCopy.length;\r\n        while(len--){\r\n            const r = this._removeMarker(markersCopy[len]);\r\n            removed = removed || r;\r\n        }\r\n        if(removed){\r\n            this.resetViewport();\r\n            this._createClusters();\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    clearMarkers(){\r\n        this.resetViewport();\r\n        let len = this._markers.length;\r\n        while(len--){\r\n            const marker = this._markers[len];\r\n            this._map.Overlays.remove(marker);\r\n        }\r\n        this._markers = [];\r\n    }\r\n\r\n    resetViewport(){\r\n        let len = this._clusters.length;\r\n        while(len--){\r\n            this._clusters[len].remove();\r\n        }\r\n        len = this._markers.length;\r\n        while(len--){\r\n            const marker = this._markers[len];\r\n            marker.isAdded = false;\r\n            this._map.Overlays.remove(marker);\r\n        }\r\n        this._clusters = [];\r\n    }\r\n}\r\n","export {default as MarkerCluster} from './MarkerCluster';\r\n"],"sourceRoot":""}